(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     44449,       1089]
NotebookOptionsPosition[     44015,       1070]
NotebookOutlinePosition[     44349,       1085]
CellTagsIndexPosition[     44306,       1082]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.671617035677352*^9, 3.671617038424417*^9}, {
   3.671687761738916*^9, 3.671687828803874*^9}, {3.67168863019788*^9, 
   3.671688635419648*^9}, {3.671688766584193*^9, 3.67168880167834*^9}, {
   3.67170018525599*^9, 3.671700192654373*^9}, {3.671704115502883*^9, 
   3.671704115919146*^9}, {3.671705960430819*^9, 3.671705962847865*^9}, {
   3.671706027434949*^9, 3.671706059893806*^9}, 3.671706303906548*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Naming", " ", "conventions"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"functionSpacePrefix", " ", "=", " ", "\"\<funSpace\>\""}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"totalSpaceName", " ", "=", " ", "\"\<totalSpace\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"totalFunction", " ", "=", " ", "\"\<w\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"weakFormName", " ", "=", " ", "\"\<F\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pointName", " ", "=", " ", "\"\<ptx\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"boundaryFunctionName", " ", "=", " ", "\"\<boundary_parts\>\""}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"START", ":", " ", 
     RowBox[{
     "THIS", " ", "IS", " ", "DONE", " ", "AND", " ", "WORKS", " ", 
      "FINE"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SymbolSeparatedStringFromList", "[", 
      RowBox[{"list_", ",", "symbol_"}], "]"}], " ", ":=", " ", 
     RowBox[{"StringJoin", "@", " ", 
      RowBox[{"(", 
       RowBox[{"ToString", "/@", " ", 
        RowBox[{"Riffle", "[", 
         RowBox[{"list", ",", "symbol"}], "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"turns", " ", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}], " ", "to", " ", 
     "\"\<a,b,c\>\""}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CommaSeparatedStringFromList", "[", "list_", "]"}], " ", ":=", 
     " ", 
     RowBox[{"SymbolSeparatedStringFromList", "[", 
      RowBox[{"list", ",", "\"\<,\>\""}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"turns", " ", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}], " ", "to", " ", 
     "\"\<a+b+c\>\""}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PlusSeparatedStringFromList", "[", "list_", "]"}], " ", ":=", 
     " ", 
     RowBox[{"SymbolSeparatedStringFromList", "[", 
      RowBox[{"list", ",", "\"\<+\>\""}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PointExpression", "[", "vars_", "]"}], ":=", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "pycPointExpression"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "vars", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pycPointExpression", " ", "=", " ", 
        RowBox[{"StringForm", "[", 
         RowBox[{
         "\"\<`1` = Expression((\\\"x[0]\\\",\\\"x[1]\\\",\\\"x[2]\\\"))\>\"",
           ",", "pointName"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "pycPointExpression"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"InitializeFunctionSpaces", "[", " ", 
     RowBox[{
     "funs_", " ", ",", "testFuns_", ",", " ", "femSpaces_", ",", "mesh_"}], 
     " ", "]"}], " ", ":=", " ", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "distinctFunctionSpaces", ",", "femSpacesNames", ",", 
        "pycSpaceInitialization", ",", "pycFunctionInitialization", ",", 
        "CreateFemSpaceName"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Make", " ", "sure", " ", "that", " ", "we", " ", "initialize", " ", 
        "each", " ", "space", " ", "only", " ", "once"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"distinctFunctionSpaces", " ", "=", " ", 
        RowBox[{"DeleteDuplicates", " ", "@", " ", "femSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Function", " ", "to", " ", "convert", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<femType\>\"", ",", "degree"}], "}"}], " ", "to", " ", 
         "the", " ", "function", " ", "space", " ", "name"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CreateFemSpaceName", "[", "femSpace_", "]"}], " ", ":=", " ", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<`1``2``3`\>\"", ",", "functionSpacePrefix", ",", 
          RowBox[{"femSpace", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"femSpace", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"femSpacesNames", " ", "=", " ", 
        RowBox[{"CreateFemSpaceName", " ", "/@", " ", "femSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Create", " ", "python", " ", "command", " ", "to", " ", "initialize",
          " ", "all", " ", "function", " ", "spaces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pycSpaceInitialization", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringForm", "[", " ", 
           RowBox[{"\"\<`1` = FunctionSpace(`4`, '`2`', `3`)\>\"", ",", 
            RowBox[{"CreateFemSpaceName", "[", "#", "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "mesh"}], " ", "]"}], "&"}],
          " ", "/@", " ", "distinctFunctionSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Create", " ", "python", " ", "command", " ", "to", " ", "initialize",
          " ", "space", " ", "of", " ", "all", " ", "spaces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", " ", 
        RowBox[{"pycSpaceInitialization", ",", " ", 
         RowBox[{"StringForm", "[", " ", 
          RowBox[{
          "\"\<`1` = MixedFunctionSpace([`2`])\>\"", ",", "totalSpaceName", 
           ",", " ", 
           RowBox[{
           "CommaSeparatedStringFromList", "[", "femSpacesNames", "]"}]}], 
          " ", "]"}]}], " ", "]"}], " ", ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Initialize", " ", "total", " ", "function"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pycFunctionInitialization", " ", "=", "  ", 
        RowBox[{"{", 
         RowBox[{"StringForm", "[", 
          RowBox[{
          "\"\<`1` = Function( `2` )\>\"", ",", "totalFunction", ",", 
           "totalSpaceName"}], "]"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Split", " ", "total", " ", "function", " ", "to", " ", "its", " ", 
         "parts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"pycFunctionInitialization", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<`1` = split(`2`)\>\"", ",", 
           RowBox[{"CommaSeparatedStringFromList", "[", "funs", "]"}], ",", 
           "totalFunction"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"pycFunctionInitialization", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<`1` = TestFunctions(`2`)\>\"", ",", 
           RowBox[{"CommaSeparatedStringFromList", "[", "testFuns", "]"}], 
           ",", "totalSpaceName"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "return", " ", "all", " ", "python", " ", "code", " ", "lines"}], " ",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"{", 
         RowBox[{"pycSpaceInitialization", ",", "pycFunctionInitialization"}],
          "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Rules", " ", "how", " ", "to", " ", "remove", " ", "function", " ", 
       "arguments", " ", "from", " ", "`fun`"}], " ", "-", " ", 
      RowBox[{"Wierd", " ", 
       RowBox[{"stuff", ":", " ", 
        RowBox[{
        "StringForm", " ", "does", " ", "not", " ", "produce", " ", 
         "string"}]}]}]}], ",", " ", 
     RowBox[{"so", " ", "ToString", " ", "is", " ", "neccessary"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RemoveFunctionArgumentRulesFun", "[", " ", 
     RowBox[{"fun_", ",", " ", "vars_"}], "]"}], " ", ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"{", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ToString", "@", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<`1`(`2`)\>\"", ",", "fun", ",", 
          RowBox[{"CommaSeparatedStringFromList", "[", "vars", "]"}]}], 
         "]"}]}], " ", "\[Rule]", " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<`1`\>\"", ",", "fun"}], "]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToString", "@", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<(`1`)(`2`)\>\"", ",", "fun", ",", 
          RowBox[{"CommaSeparatedStringFromList", "[", "vars", "]"}]}], " ", 
         "]"}]}], "\[Rule]", "  ", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<(`1`)\>\"", ",", "fun"}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateWeakForm", "[", 
     RowBox[{"weak_", ",", "funs_", ",", "testFuns_", ",", "vars_"}], "]"}], 
    " ", ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", "removeFunctionArgumentRules", ",", "pointRules", ",", 
        "rules", ",", "weakFormNames", ",", "weakCForms", ",", 
        "pycWeakForm"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"Length", "[", "vars", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"Length", "[", "weak", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"removeFunctionArgumentRules", " ", "=", "  ", 
        RowBox[{"Flatten", " ", "@", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"RemoveFunctionArgumentRulesFun", "[", 
             RowBox[{"#", ",", "vars"}], "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"funs", ",", "testFuns"}], "}"}], "]"}]}], ")"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"pointRules", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ToString", "@", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], " ", "\[Rule]", " ", 
            RowBox[{"ToString", "@", 
             RowBox[{"StringForm", "[", 
              RowBox[{"\"\<`1`[`2`]\>\"", ",", "pointName", ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], " ", ")"}], "  ",
           "&"}], "/@", " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"vars", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{"n", "-", "1"}]}], "]"}]}], "}"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"weakFormNames", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1``2`\>\"", ",", "weakFormName", ",", "#"}], "]"}], 
          "&"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "m"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"Flatten", " ", "@", 
         RowBox[{"{", 
          RowBox[{"removeFunctionArgumentRules", ",", "pointRules"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"weakCForms", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringReplace", "[", 
           RowBox[{
            RowBox[{"ToString", "@", "#"}], ",", "rules"}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{"CForm", " ", "/@", " ", "weak"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pycWeakForm", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringForm", "[", "  ", 
           RowBox[{"\"\<`1` = (`2`)*dx\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"weakFormNames", ",", "weakCForms"}], "}"}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", " ", 
        RowBox[{"pycWeakForm", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<`1` = `2`\>\"", ",", " ", "weakFormName", ",", " ", 
           RowBox[{
           "PlusSeparatedStringFromList", "[", "weakFormNames", " ", "]"}]}], 
          " ", "]"}]}], "]"}], ";", "\[IndentingNewLine]", "pycWeakForm"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BCName", "[", 
      RowBox[{"fun_", ",", "bcId_"}], "]"}], ":=", " ", 
     RowBox[{"StringForm", "[", 
      RowBox[{"\"\<bc_`1`_`2`\>\"", ",", "fun", ",", "bcId"}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BCNames", "[", 
      RowBox[{"fun_", ",", "bc_"}], "]"}], ":=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"BCName", "[", 
        RowBox[{"fun", ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], " ", "&"}], " ", "/@",
       " ", "bc"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ConstantBoundaryCond", "[", 
     RowBox[{"fun_", ",", "funId_", ",", "bc_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "pycBC", ",", "bcNames"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", " ", 
        RowBox[{"Length", "[", "bc", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pycBC", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"StringForm", "[", " ", 
           RowBox[{
           "\"\<`1` = DirichletBC(`2`.sub(`3`), Constant(`4`), `5`, `6`)\>\"",
             ",", 
            RowBox[{"BCName", "[", 
             RowBox[{"fun", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], ",", 
            "totalSpaceName", ",", "funId", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
            "boundaryFunctionName", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}], "&"}], " ", "/@",
          " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", "n"}], "]"}], ",", "bc"}], "}"}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "pycBC"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ConstantBoundaryConditions", "[", 
     RowBox[{"funs_", ",", "bcs_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "funsIdsBcsList", ",", "bcNames", ",", "pycBC"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "funs", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"funsIdsBcsList", " ", "=", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"funs", ",", 
           RowBox[{"Range", "[", 
            RowBox[{"0", ",", 
             RowBox[{"n", "-", "1"}]}], "]"}], ",", "bcs"}], "}"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"pycBC", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ConstantBoundaryCond", "[", " ", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "]"}], " ", "&"}], " ", "/@", 
         " ", "funsIdsBcsList"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bcNames", " ", "=", "  ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"BCNames", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", 
          " ", "funsIdsBcsList"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", " ", 
        RowBox[{"pycBC", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<bc = [`1`]\>\"", ",", " ", 
           RowBox[{"SymbolSeparatedStringFromList", "[", 
            RowBox[{"bcNames", ",", "\"\<,\>\""}], "]"}]}], "]"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "pycBC"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenerateCode", "[", 
     RowBox[{
     "fileName_", ",", "mesh_", ",", "vars_", ",", "funs_", ",", " ", "bcs_", 
      ",", "testFuns_", ",", "femSpaces_", ",", "weakForm_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "code", ",", "code0", ",", "code1", ",", "code2", ",", "code3", " ", 
        ",", "code4", ",", "outFile"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "code0", " ", "=", " ", "\"\<from mathematicaFunctions import *\>\""}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"code1", " ", "=", " ", 
        RowBox[{"PointExpression", "[", "vars", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"code2", "  ", "=", " ", 
        RowBox[{"InitializeFunctionSpaces", "[", 
         RowBox[{"funs", ",", "testFuns", ",", "femSpaces", ",", "mesh"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"code3", " ", "=", " ", 
        RowBox[{"CreateWeakForm", "[", 
         RowBox[{"weakForm", ",", "funs", ",", "testFuns", ",", "vars"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"code4", " ", "=", " ", 
        RowBox[{"ConstantBoundaryConditions", "[", 
         RowBox[{"funs", ",", "bcs"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"code", " ", "=", " ", 
        RowBox[{"SymbolSeparatedStringFromList", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"{", 
            RowBox[{
            "code0", ",", "code1", ",", "code2", ",", "code3", ",", "code4"}],
             "}"}]}], ",", "\"\<\\n\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"outFile", " ", "=", " ", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToString", "@", 
            RowBox[{"NotebookDirectory", "[", "]"}]}], ",", "fileName"}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"DeleteFile", "[", "outFile", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"WriteString", "[", 
        RowBox[{"outFile", ",", "code"}], " ", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.6716170525778627`*^9, 3.671617058382256*^9}, {
   3.671617109861968*^9, 3.671617250617429*^9}, {3.671617855570417*^9, 
   3.6716178772671347`*^9}, {3.671640633225995*^9, 3.671640633798319*^9}, {
   3.671640824170699*^9, 3.671640871188406*^9}, {3.6716409740204363`*^9, 
   3.671641005849267*^9}, {3.671641077744791*^9, 3.671641097836274*^9}, {
   3.671641186309668*^9, 3.671641192724751*^9}, {3.671641236527544*^9, 
   3.671641239680047*^9}, {3.671641318261857*^9, 3.671641323478581*^9}, {
   3.6716413576216087`*^9, 3.671641413849897*^9}, {3.6716414544733553`*^9, 
   3.671641537127747*^9}, {3.671641827136051*^9, 3.671642057606167*^9}, {
   3.6716421081969*^9, 3.6716422431863613`*^9}, {3.6716423174528723`*^9, 
   3.6716424015689917`*^9}, {3.6716424744520807`*^9, 3.671642541363044*^9}, {
   3.6716426137657413`*^9, 3.6716426366655188`*^9}, {3.6716426686296*^9, 
   3.6716427972586517`*^9}, {3.671642836637865*^9, 3.671642865642496*^9}, {
   3.671643553005066*^9, 3.671643571008688*^9}, {3.671643601281147*^9, 
   3.671643607103442*^9}, {3.671644085131233*^9, 3.6716441795253553`*^9}, {
   3.671644222944057*^9, 3.6716442883932953`*^9}, {3.671644468458661*^9, 
   3.671644771471283*^9}, {3.671644804673543*^9, 3.671644893585561*^9}, {
   3.671645024260243*^9, 3.671645195410631*^9}, {3.671646648559854*^9, 
   3.671646831372085*^9}, {3.671647039163332*^9, 3.671647131901408*^9}, {
   3.671648177992697*^9, 3.67164820540007*^9}, {3.6716483238365173`*^9, 
   3.6716483960205097`*^9}, {3.671648502281993*^9, 3.671648518908697*^9}, {
   3.671648555465076*^9, 3.6716485678308477`*^9}, {3.6716866447277822`*^9, 
   3.6716866705667753`*^9}, {3.671686743686048*^9, 3.671686795756487*^9}, {
   3.67168833548175*^9, 3.671688335640461*^9}, {3.671695592451787*^9, 
   3.671695690075677*^9}, {3.671699917223173*^9, 3.67169992496202*^9}, {
   3.671700045643222*^9, 3.6717001592126303`*^9}, {3.6717002023748007`*^9, 
   3.6717002122367907`*^9}, {3.671700602763666*^9, 3.67170062369201*^9}, {
   3.671701093529223*^9, 3.67170113340307*^9}, {3.671701325165485*^9, 
   3.671701409744808*^9}, {3.6717014400588408`*^9, 3.67170163691705*^9}, 
   3.6717016844758263`*^9, {3.671702036766858*^9, 3.6717020586513653`*^9}, {
   3.671702162986537*^9, 3.671702168874947*^9}, {3.671702457630163*^9, 
   3.671702552194502*^9}, {3.671702675749894*^9, 3.671702779310029*^9}, {
   3.6717028805138702`*^9, 3.671702943694316*^9}, {3.6717030607215652`*^9, 
   3.6717031263841457`*^9}, {3.671703160322363*^9, 3.671703316377302*^9}, {
   3.6717033947892103`*^9, 3.671703483587324*^9}, 3.67170352951799*^9, {
   3.6717035599671097`*^9, 3.6717035716368113`*^9}, {3.67170425283362*^9, 
   3.67170429336209*^9}, {3.671704378833199*^9, 3.671704407859864*^9}, {
   3.671704504510241*^9, 3.671704504991078*^9}, {3.671704851846657*^9, 
   3.671704876351372*^9}, {3.6717054050982533`*^9, 3.671705470661641*^9}, {
   3.6717055041544228`*^9, 3.671705546322172*^9}, {3.6717057041419077`*^9, 
   3.671705838757367*^9}, {3.67170601333438*^9, 3.671706014881795*^9}, {
   3.671706280941773*^9, 3.67170628522443*^9}, {3.671706410874763*^9, 
   3.671706410982856*^9}, 3.671706530074592*^9, {3.671707097338669*^9, 
   3.671707098612927*^9}, {3.67170713839406*^9, 3.671707140905657*^9}, {
   3.671710390081972*^9, 3.671710564376107*^9}, {3.6717110430020647`*^9, 
   3.6717112812160463`*^9}, {3.6717113897394857`*^9, 3.67171142768563*^9}, {
   3.671711827082773*^9, 3.67171198240033*^9}, {3.6717125193525963`*^9, 
   3.671712563748597*^9}, {3.671714094432481*^9, 3.671714108558772*^9}, {
   3.6717142543379307`*^9, 3.671714336391364*^9}, {3.6717162974837437`*^9, 
   3.671716797354842*^9}, {3.671716836401424*^9, 3.671716837734118*^9}, {
   3.6717168755367613`*^9, 3.671716980843685*^9}, {3.671717012096696*^9, 
   3.671717015001481*^9}, {3.671717054614519*^9, 3.671717379135635*^9}, {
   3.671717424133497*^9, 3.6717174770102453`*^9}, {3.671717629450048*^9, 
   3.671717683236525*^9}, {3.671717716989011*^9, 3.671717863357829*^9}, {
   3.671717897242057*^9, 3.6717179368330107`*^9}, {3.6717179702219057`*^9, 
   3.6717180678140697`*^9}, {3.671718101782795*^9, 3.671718122881221*^9}, {
   3.6717181758945847`*^9, 3.671718181639155*^9}, {3.67171889151267*^9, 
   3.671718905517891*^9}, {3.671719027035555*^9, 3.6717190312750177`*^9}, {
   3.67171910985072*^9, 3.67171911012815*^9}, 3.671720237283787*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mesh", " ", ":=", " ", "\"\<mesh\>\""}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"string", " ", "used", " ", "to", " ", "describe", " ", "mesh"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vars", " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"variables", " ", "in", " ", "which", " ", "we", " ", "solve"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"funs", " ", ":=", " ", 
    RowBox[{"{", "  ", 
     RowBox[{"u", ",", "v"}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "unknown", " ", "functions", " ", "we", " ", "want", " ", "to", " ", 
    "find"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"bcs", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], "}"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testFuns", " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"tu", ",", "tv"}], "}"}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"test", " ", "functions"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"femSpaces", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<Lagrange\>\"", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Lagrange\>\"", ",", "1"}], "}"}]}], "}"}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"FEM", " ", "spaces", " ", "of", " ", "functions"}], ",", " ", 
    RowBox[{"syntax", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<FEM space name\>\"", ",", "degree"}], "}"}], ",", 
       "..."}], "}"}]}], ",", " ", 
    RowBox[{
     RowBox[{"For", " ", "available", " ", "function", " ", "spaces", " ", 
      RowBox[{"see", ":", " ", "http", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"fenicsproject", ".", "org"}], "/", "documentation"}], "/",
           "dolfin"}], "/", "dev"}], "/", "python"}], "/", "programmers"}], 
      "-", 
      RowBox[{
       RowBox[{
        RowBox[{"reference", "/", "functions"}], "/", "functionspace"}], "/", 
       
       RowBox[{"FunctionSpace", ".", "html"}]}]}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"weak1", " ", ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       SuperscriptBox[
        RowBox[{"u", "[", 
         RowBox[{"x", ",", "y"}], "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"v", "[", 
         RowBox[{"x", ",", "y"}], "]"}], "2"]}], ")"}], 
     RowBox[{
      RowBox[{"Grad", "[", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}]}], "]"}], ".", 
      RowBox[{"Grad", "[", 
       RowBox[{
        RowBox[{"tu", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}]}], " ", "-", 
    RowBox[{
     RowBox[{"Sin", "[", "x", "]"}], " ", 
     RowBox[{"tu", "[", 
      RowBox[{"x", ",", "y"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"weak2", " ", ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       SuperscriptBox[
        RowBox[{"u", "[", 
         RowBox[{"x", ",", "y"}], "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"v", "[", 
         RowBox[{"x", ",", "y"}], "]"}], "2"]}], ")"}], 
     RowBox[{
      RowBox[{"Grad", "[", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}]}], "]"}], ".", 
      RowBox[{"Grad", "[", 
       RowBox[{
        RowBox[{"tv", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}]}], " ", "+", 
    RowBox[{
     RowBox[{"Cos", "[", "y", "]"}], " ", 
     RowBox[{"tv", "[", 
      RowBox[{"x", ",", "y"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"weakForm", " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"weak1", ",", "weak2"}], "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateCode", "[", 
    RowBox[{
    "\"\<test.py\>\"", ",", "mesh", ",", "vars", ",", "funs", ",", "bcs", ",",
      "testFuns", ",", "femSpaces", ",", "weakForm"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6716170525778627`*^9, 3.671617058382256*^9}, {
   3.671617109861968*^9, 3.671617250617429*^9}, {3.671617855570417*^9, 
   3.6716178772671347`*^9}, {3.671640633225995*^9, 3.671640633798319*^9}, {
   3.671640824170699*^9, 3.671640871188406*^9}, {3.6716409740204363`*^9, 
   3.671641005849267*^9}, {3.671641077744791*^9, 3.671641097836274*^9}, {
   3.671641186309668*^9, 3.671641192724751*^9}, {3.671641236527544*^9, 
   3.671641239680047*^9}, {3.671641318261857*^9, 3.671641323478581*^9}, {
   3.6716413576216087`*^9, 3.671641413849897*^9}, {3.6716414544733553`*^9, 
   3.671641537127747*^9}, {3.671641827136051*^9, 3.671642057606167*^9}, {
   3.6716421081969*^9, 3.6716422431863613`*^9}, {3.6716423174528723`*^9, 
   3.6716424015689917`*^9}, {3.6716424744520807`*^9, 3.671642541363044*^9}, {
   3.6716426137657413`*^9, 3.6716426366655188`*^9}, {3.6716426686296*^9, 
   3.6716427972586517`*^9}, {3.671642836637865*^9, 3.671642865642496*^9}, {
   3.671643553005066*^9, 3.671643571008688*^9}, {3.671643601281147*^9, 
   3.671643607103442*^9}, {3.671644085131233*^9, 3.6716441795253553`*^9}, {
   3.671644222944057*^9, 3.6716442883932953`*^9}, {3.671644468458661*^9, 
   3.671644771471283*^9}, {3.671644804673543*^9, 3.671644893585561*^9}, {
   3.671645024260243*^9, 3.671645195410631*^9}, {3.671646648559854*^9, 
   3.671646831372085*^9}, {3.671647039163332*^9, 3.671647131901408*^9}, {
   3.671648177992697*^9, 3.67164820540007*^9}, {3.6716483238365173`*^9, 
   3.6716483960205097`*^9}, {3.671648502281993*^9, 3.671648518908697*^9}, {
   3.671648555465076*^9, 3.6716485678308477`*^9}, {3.6716866447277822`*^9, 
   3.6716866705667753`*^9}, {3.671686743686048*^9, 3.671686795756487*^9}, {
   3.67168833548175*^9, 3.671688335640461*^9}, {3.671695592451787*^9, 
   3.671695690075677*^9}, {3.671699917223173*^9, 3.67169992496202*^9}, {
   3.671700045643222*^9, 3.6717001592126303`*^9}, {3.6717002023748007`*^9, 
   3.6717002122367907`*^9}, {3.671700602763666*^9, 3.67170062369201*^9}, {
   3.671701093529223*^9, 3.67170113340307*^9}, {3.671701325165485*^9, 
   3.671701409744808*^9}, {3.6717014400588408`*^9, 3.67170163691705*^9}, 
   3.6717016844758263`*^9, {3.671702036766858*^9, 3.6717020586513653`*^9}, {
   3.671702162986537*^9, 3.671702168874947*^9}, {3.671702457630163*^9, 
   3.671702552194502*^9}, {3.671702675749894*^9, 3.671702779310029*^9}, {
   3.6717028805138702`*^9, 3.671702943694316*^9}, {3.6717030607215652`*^9, 
   3.6717031263841457`*^9}, {3.671703160322363*^9, 3.671703316377302*^9}, {
   3.6717033947892103`*^9, 3.671703483587324*^9}, 3.67170352951799*^9, {
   3.6717035599671097`*^9, 3.6717035716368113`*^9}, {3.67170425283362*^9, 
   3.67170429336209*^9}, {3.671704378833199*^9, 3.671704407859864*^9}, {
   3.671704504510241*^9, 3.671704504991078*^9}, {3.671704851846657*^9, 
   3.671704876351372*^9}, {3.6717054050982533`*^9, 3.671705470661641*^9}, {
   3.6717055041544228`*^9, 3.671705546322172*^9}, {3.6717057041419077`*^9, 
   3.671705838757367*^9}, {3.67170601333438*^9, 3.671706014881795*^9}, {
   3.671706280941773*^9, 3.67170628522443*^9}, {3.671706410874763*^9, 
   3.671706410982856*^9}, 3.671706530074592*^9, {3.671707923236207*^9, 
   3.671707926114953*^9}, {3.671707982392973*^9, 3.671708016548265*^9}, {
   3.671708756733287*^9, 3.671708794167465*^9}, {3.6717108376919813`*^9, 
   3.6717108433856707`*^9}, {3.6717109011931257`*^9, 3.671710920582416*^9}, {
   3.671711006965014*^9, 3.6717110107225723`*^9}, {3.671711435257965*^9, 
   3.67171145827697*^9}, {3.67171149915342*^9, 3.6717114999784727`*^9}, 
   3.671711901458552*^9, {3.671711958616981*^9, 3.671712009918186*^9}, {
   3.671718140993916*^9, 3.6717181523912363`*^9}, {3.671718861232175*^9, 
   3.671718865757245*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Rey", " ", "=", " ", "0.1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vars", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"funs", ":=", " ", 
     RowBox[{"{", 
      RowBox[{"vx", ",", "vy", ",", "p"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"bcs", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", "}"}]}], "}"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"testFuns", " ", ":=", 
     RowBox[{"{", 
      RowBox[{"tvx", ",", "tvy", ",", "tp"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"femSpaces", " ", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<CG\>\"", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<CG\>\"", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<CG\>\"", ",", "1"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"V", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vx", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", 
       RowBox[{"vy", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TV", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"tvx", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", 
       RowBox[{"tvy", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P", " ", ":=", " ", 
     RowBox[{"p", "[", 
      RowBox[{"x", ",", "y"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TP", " ", ":=", " ", 
     RowBox[{"tp", "[", 
      RowBox[{"x", ",", "y"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"weak1", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Grad", "[", 
          RowBox[{"V", ",", "vars"}], "]"}], ".", "V"}], " ", ")"}], ".", 
       "TV"}], "-", 
      RowBox[{"P", " ", 
       RowBox[{"Div", "[", 
        RowBox[{"TV", ",", "vars"}], "]"}]}], "+", " ", 
      RowBox[{
       FractionBox["1", "Rey"], 
       RowBox[{"Tr", "[", 
        RowBox[{
         RowBox[{"Grad", "[", 
          RowBox[{"V", ",", "vars"}], "]"}], ".", " ", 
         RowBox[{"Transpose", " ", "@", 
          RowBox[{"Grad", "[", 
           RowBox[{"TV", ",", "vars"}], "]"}]}]}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"weak2", " ", "=", " ", 
     RowBox[{
      RowBox[{"Div", "[", 
       RowBox[{"V", ",", "vars"}], "]"}], " ", "TP"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"weakForm", "=", " ", 
    RowBox[{"{", 
     RowBox[{"weak1", ",", "weak2"}], "}"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenerateCode", "[", 
     RowBox[{
     "\"\<NavierStokes.py\>\"", ",", "mesh", ",", "vars", ",", "funs", ",", 
      "bcs", ",", "testFuns", ",", "femSpaces", ",", "weakForm"}], "]"}], 
    ";"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.6717129810184317`*^9, 3.6717131063234777`*^9}, {
   3.671713205188929*^9, 3.67171325433676*^9}, {3.6717133194062443`*^9, 
   3.671713390284865*^9}, {3.671713446415316*^9, 3.67171351299646*^9}, {
   3.671713567378015*^9, 3.671713661439653*^9}, {3.6717137087920437`*^9, 
   3.671713766984618*^9}, {3.6717138632746677`*^9, 3.67171391101311*^9}, {
   3.671713958942758*^9, 3.671713996821159*^9}, {3.6717141589229603`*^9, 
   3.6717141810864887`*^9}, 3.671714299965479*^9, {3.671714357378367*^9, 
   3.671714364067113*^9}, {3.671714606362426*^9, 3.671714611011669*^9}, {
   3.671714643788087*^9, 3.6717146445584383`*^9}, {3.671714982464397*^9, 
   3.67171498325738*^9}, {3.6717161952088127`*^9, 3.671716202042222*^9}, {
   3.67171623375525*^9, 3.671716283495922*^9}, {3.671718130302169*^9, 
   3.671718131435051*^9}, {3.671720254050808*^9, 3.671720261266798*^9}, {
   3.671729968672833*^9, 3.671730007020198*^9}, {3.67173008053771*^9, 
   3.671730093997279*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"p", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["tvy", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{"x", ",", "y"}], "]"}], "+", 
       RowBox[{
        SuperscriptBox["tvx", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{"x", ",", "y"}], "]"}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"tvx", "[", 
      RowBox[{"x", ",", "y"}], "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"vy", "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"vx", "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"tvy", "[", 
      RowBox[{"x", ",", "y"}], "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"vy", "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"vx", "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}]}], ")"}]}], "+", 
    RowBox[{"10.`", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox["tvx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{
         SuperscriptBox["tvy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{
         SuperscriptBox["tvx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vx", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{
         SuperscriptBox["tvy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox["vy", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"x", ",", "y"}], "]"}]}]}], ")"}]}]}], ",", 
   RowBox[{
    RowBox[{"tp", "[", 
     RowBox[{"x", ",", "y"}], "]"}], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox["vy", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "1"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"x", ",", "y"}], "]"}], "+", 
      RowBox[{
       SuperscriptBox["vx", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"1", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ")"}]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.671713967413703*^9, 3.6717139971289787`*^9}, 
   3.6717141136010237`*^9, {3.671714152478797*^9, 3.671714181394916*^9}, {
   3.6717142839903393`*^9, 3.6717143652507067`*^9}, 3.6717149849191933`*^9, 
   3.671715451843687*^9, 3.6717180928157988`*^9, 3.671718156036437*^9, 
   3.671718188313963*^9, 3.671718989388822*^9, 3.671719041744728*^9, 
   3.671719117345038*^9, {3.671720243881024*^9, 3.671720263281394*^9}, 
   3.671730019722809*^9, {3.6717301018868113`*^9, 3.671730106986231*^9}}]
}, Open  ]]
},
WindowSize->{1918, 1003},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.0 for Linux x86 (64-bit) (June 27, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 453, 6, 32, "Input"],
Cell[1014, 28, 24331, 535, 2181, "Input"],
Cell[25348, 565, 8368, 190, 339, "Input"],
Cell[CellGroupData[{
Cell[33741, 759, 4712, 128, 472, "Input"],
Cell[38456, 889, 5543, 178, 76, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
