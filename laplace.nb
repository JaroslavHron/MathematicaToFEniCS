(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     10959,        275]
NotebookOptionsPosition[     10613,        258]
NotebookOutlinePosition[     10947,        273]
CellTagsIndexPosition[     10904,        270]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"foo", "=", 
     RowBox[{
      RowBox[{"RawBoxes", "[", 
       RowBox[{"Replace", "[", 
        RowBox[{
         RowBox[{"ToBoxes", "@", "#"}], ",", 
         RowBox[{
          RowBox[{"InterpretationBox", "[", 
           RowBox[{"a_", ",", "b_", ",", "c___"}], "]"}], "\[RuleDelayed]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"aa", "=", 
              RowBox[{"StringReplace", "[", 
               RowBox[{"a", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\"\<Sqrt\>\"", "\[Rule]", "\"\<sqrt\>\""}], ",", 
                  RowBox[{"\"\<Power(E,\>\"", "\[Rule]", "\"\<exp(\>\""}], 
                  ",", 
                  RowBox[{"\"\<Power\>\"", "\[Rule]", "\"\<pow\>\""}]}], 
                 "}"}]}], "]"}]}], "}"}], ",", "aa"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "Infinity"}], "}"}]}], "]"}], "]"}], "&"}]}], 
    ";"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.671617035677352*^9, 3.671617038424417*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Naming", " ", "conventions"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"functionSpacePrefix", " ", "=", " ", "\"\<funSpace\>\""}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"totalSpaceName", " ", "=", " ", "\"\<totalSpace\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"totalFunction", " ", "=", " ", "\"\<w\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mesh", " ", ":=", " ", "\"\<mesh\>\""}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{"string", " ", "used", " ", "to", " ", "describe", " ", "mesh"}],
      " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"vars", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"variables", " ", "in", " ", "which", " ", "we", " ", "solve"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"funs", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{"u", ",", "v"}], "}"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "unknown", " ", "functions", " ", "we", " ", "want", " ", "to", " ", 
     "find"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"testFuns", " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{"t_u", ",", "t_v"}], "}"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"test", " ", "functions"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"femSpaces", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<Lagrange\>\"", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Lagrange\>\"", ",", "1"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"turns", " ", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}], " ", "to", " ", 
     "\"\<a,b,c\>\""}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CommaSeparatedStringFromList", "[", "list_", "]"}], " ", ":=", 
     " ", 
     RowBox[{"StringJoin", "@", " ", 
      RowBox[{"(", 
       RowBox[{"ToString", "/@", " ", 
        RowBox[{"Riffle", "[", 
         RowBox[{"list", ",", "\"\<,\>\""}], "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"InitializeFunctionSpaces", "[", " ", 
     RowBox[{
     "funs_", " ", ",", "testFuns_", ",", " ", "femSpaces_", ",", "mesh_"}], 
     " ", "]"}], " ", ":=", " ", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "distinctFunctionSpaces", ",", "femSpacesNames", ",", 
        "pycSpaceInitialization", ",", "pycFunctionInitialization", ",", 
        "CreateFemSpaceName"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Make", " ", "sure", " ", "that", " ", "we", " ", "initialize", " ", 
        "each", " ", "space", " ", "only", " ", "once"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"distinctFunctionSpaces", " ", "=", " ", 
        RowBox[{"DeleteDuplicates", " ", "@", " ", "femSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Function", " ", "to", " ", "convert", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<femType\>\"", ",", "degree"}], "}"}], " ", "to", " ", 
         "the", " ", "function", " ", "space", " ", "name"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CreateFemSpaceName", "[", "femSpace_", "]"}], " ", ":=", " ", 
        RowBox[{"StringForm", "[", 
         RowBox[{"\"\<`1``2``3`\>\"", ",", "functionSpacePrefix", ",", 
          RowBox[{"femSpace", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"femSpace", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"femSpacesNames", " ", "=", " ", 
        RowBox[{"CreateFemSpaceName", " ", "/@", " ", "femSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Create", " ", "python", " ", "command", " ", "to", " ", "initialize",
          " ", "all", " ", "function", " ", "spaces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pycSpaceInitialization", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringForm", "[", " ", 
           RowBox[{"\"\<`1` = FunctionSpace(`4`,`2`,`3`)\>\"", ",", 
            RowBox[{"CreateFemSpaceName", "[", "#", "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "mesh"}], " ", "]"}], "&"}],
          " ", "/@", " ", "distinctFunctionSpaces"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Create", " ", "python", " ", "command", " ", "to", " ", "initialize",
          " ", "space", " ", "of", " ", "all", " ", "spaces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", " ", 
        RowBox[{"pycSpaceInitialization", ",", " ", 
         RowBox[{"StringForm", "[", " ", 
          RowBox[{
          "\"\<`1` = MixedSpace([`2`])\>\"", ",", "totalSpaceName", ",", " ", 
           
           RowBox[{
           "CommaSeparatedStringFromList", "[", "femSpacesNames", "]"}]}], 
          " ", "]"}]}], " ", "]"}], " ", ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Initialize", " ", "total", " ", "function"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pycFunctionInitialization", " ", "=", "  ", 
        RowBox[{"{", 
         RowBox[{"StringForm", "[", 
          RowBox[{
          "\"\<`1` = Function( `2` )\>\"", ",", "totalFunction", ",", 
           "totalSpaceName"}], "]"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Split", " ", "total", " ", "function", " ", "to", " ", "its", " ", 
         "parts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"pycFunctionInitialization", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<`1` = split(`2`)\>\"", ",", 
           RowBox[{"CommaSeparatedStringFromList", "[", "funs", "]"}], ",", 
           "totalFunction"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"pycFunctionInitialization", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<`1` = TestFunctions(`2`)\>\"", ",", 
           RowBox[{"CommaSeparatedStringFromList", "[", "testFuns", "]"}], 
           ",", "totalSpaceName"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "return", " ", "all", " ", "python", " ", "code", " ", "lines"}], " ",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"{", 
         RowBox[{"pycSpaceInitialization", ",", "pycFunctionInitialization"}],
          "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"InitializeFunctionSpaces", "[", 
    RowBox[{"funs", ",", "femSpaces", ",", "mesh"}], "]"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdyk8oQwEAx/FZaQ6sHUSbC9pskymbFVbLDiwZls3lreZPb4pWzwilpu0i
sqG1d0OplYVRaFubwzwOUtqFki1NJH/KYbHiMu/3Dt8+l2/dGDXo4PN4PAkb
fHAHLipsnwaXznQJ9XTyGv6dW7Iw05mXC1ntvnAjJHRyo5j1drWd0z5XOgyd
glcSTu6mXFCtSs5C611sETJMhxfevPX4oLKl2g9DTxsBmGd+OOtHrzbhipna
gm0vJzvQpk6GYUKWjkBvlTQOlwkyC+MOzS8s6VsqwoOCQyRh/XIfimGzVi2F
0/P9Kijc3tfCb09cz329tAEeyYJdMNcdHoLkRJCA1vVWO/Qoa09hk3EkChVF
RQKODzxzijShAoymp/g1rDHtowDm6HIRJCJrDTBVSZngnp82w4+zYxt8t5Q5
4cw9uQD/AeNnu5k=
  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   InterpretationBox["\<\"\\!\\(\\\"funSpaceLagrange\\\\!\\\\(1\\\\)\\\"\\) = \
FunctionSpace(mesh,Lagrange,\\!\\(1\\))\"\>",
    StringForm["`1` = FunctionSpace(`4`,`2`,`3`)", 
     StringForm["`1``2``3`", "funSpace", "Lagrange", 1], "Lagrange", 1, 
     "mesh"],
    Editable->False], ",", 
   InterpretationBox["\<\"totalSpace = \
MixedSpace([funSpaceLagrange1,funSpaceLagrange1])\"\>",
    StringForm[
    "`1` = MixedSpace([`2`])", "totalSpace", 
     "funSpaceLagrange1,funSpaceLagrange1"],
    Editable->False], ",", 
   InterpretationBox["\<\"w = Function( totalSpace )\"\>",
    StringForm["`1` = Function( `2` )", "w", "totalSpace"],
    Editable->False], ",", 
   InterpretationBox["\<\"u,v = split(w)\"\>",
    StringForm["`1` = split(`2`)", "u,v", "w"],
    Editable->False]}], "}"}]], "Output",
 CellChangeTimes->{{3.671644157986205*^9, 3.671644179908153*^9}, 
   3.671644248457223*^9, {3.67164466641833*^9, 3.671644847862294*^9}, 
   3.671644895738159*^9, 3.671644966807887*^9, 3.671645105618761*^9}]
}, Open  ]]
},
WindowSize->{1920, 1004},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.0 for Linux x86 (64-bit) (June 27, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1154, 29, 77, "Input"],
Cell[CellGroupData[{
Cell[1737, 53, 7802, 177, 781, "Input"],
Cell[9542, 232, 1055, 23, 32, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
